!function(t){var e={};function r(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(s,i,(function(e){return t[e]}).bind(null,i));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s="WZ91")}({"2Sa7":function(t,e,r){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),(s=e.Operator||(e.Operator={})).POWER="^",s.DIVISION="/",s.TIMES="*",s.ELEM_W_TIMES="%",s.MINUS="-",s.PLUS="+"},"8IFf":function(t,e,r){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),(s=e.BuildInMathFn||(e.BuildInMathFn={})).abs="abs",s.acos="acos",s.acosh="acosh",s.asin="asin",s.asinh="asinh",s.atan="atan",s.atanh="atanh",s.ceil="ceil",s.cbrt="cbrt",s.cos="cos",s.cosh="cosh",s.exp="exp",s.floor="floor",s.log="log",s.log1p="log1p",s.log2="log2",s.log10="log10",s.max="max",s.min="min",s.pow="pow",s.round="round",s.sign="sign",s.sin="sin",s.sinh="sinh",s.sqrt="sqrt",s.tan="tan",s.tanh="tanh",s.trunc="trunc"},Rvsa:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=r("kCE4"),i=r("2Sa7"),o=r("8IFf"),n=r("a/+t");var a,c,l;function u(t,r){const s=e.isBuildInMathFn(t),o=e.isBuildInMathFn(r);return s&&o?r.length-t.length:s?-1:o?1:Object.keys(i.Operator).findIndex(e=>e===t)-Object.keys(i.Operator).findIndex(t=>t===r)}function h(t=[]){const r=t.findIndex((r,s)=>!(r!==i.Operator.MINUS||e.is_number(t[s-1])||e.is_matrix(t[s-1])||t[s-1]===l.RIGHT));return r>-1?[...t.slice(0,r),l.LEFT,-1,l.RIGHT,i.Operator.TIMES,...h(t.slice(r+1))]:t}function p(t,r=e.all_operator_symbols){return f(t,r[0]).map(t=>r.length>1&&!e.all_operator_symbols.includes(t)?p(t,r.filter((t,e)=>e>0)):[d(t)]).reduce((t,e)=>[...t,...e],[])}function d(t){const r=parseFloat(t);if(e.all_operator_symbols.includes(t))return t;if(!Number.isNaN(r))return r;if(a.EQ===t)return t;throw new Error(`Cannot parse expression ${t} as ExpressionPart.`)}function f(t="",e){const r=t.indexOf(e);if(-1===r)return[t];{const s=r+e.length-1;return[...r>0?[t.substring(0,r)]:[],e,...s<t.length-1?f(t.substring(s+1),e):[]]}}function m(t){for(t=[...t];t.includes(l.LEFT);){const e=t.findIndex(t=>t===l.LEFT),r=w(t,e),s=m(t.slice(e+1,r));t=[...t.slice(0,e),s,...t.slice(r+1)]}const e=_(t).map(t=>g(t)).map(t=>t[0]);return e.length>1?e:e[0]}function _(t){const e=t.findIndex(t=>t===c.COMMA);return e<0?[t]:[t.slice(0,e),..._(t.slice(e+1))]}function w(t,e){let r=1;for(let[s,i]of t.slice(e+1).entries())if(i===l.RIGHT){if(1===r)return e+1+s;r-=1}else i===l.LEFT&&(r+=1);throw new Error("miss-matching parenthesis in expression")}function g(t){return t=[...t],e.all_operator_symbols.sort(u).forEach(r=>{for(;t.includes(r);){const s=t.findIndex(t=>r===t);if(e.isOperator(r)){const e=s-1,i=s+1,o=O(r,t[e],t[i]);t=[...t.slice(0,e),o,...t.slice(i+1)]}else if(e.isBuildInMathFn(r)){const e=s+1,i=v(r,t[e]);t=[...t.slice(0,s),i,...t.slice(e+1)]}}}),t}function O(t,e,r){const s="number"==typeof e,o="number"==typeof r;if(s&&o)switch(t){case i.Operator.PLUS:return e+r;case i.Operator.MINUS:return e-r;case i.Operator.POWER:return e**r;case i.Operator.DIVISION:return e/r;case i.Operator.ELEM_W_TIMES:case i.Operator.TIMES:return e*r;default:throw new Error(`Not supported operator ${t} between numbers.`)}const a=(t,e)=>n.mat(...e.shape()).fill(t);return e=s?a(e,r):e,r=o?a(r,e):r,!s&&!o||t!==i.Operator.TIMES&&t!==i.Operator.ELEM_W_TIMES?e[t](r):e.apply((t,e,s)=>t*r.get(e,s))}function v(t,e){if(Array.isArray(e)){const r=e.find(t=>t instanceof s.Matrix);if(r){const s=e.map(t=>"number"==typeof t?n.mat(...r.shape()).fill(t):t);return b(t,s)}return Math[""+t](...e)}return"number"==typeof e?Math[""+t](e):e.apply(e=>Math[""+t](e))}function b(t,e){const r=n.mat(...e[0].shape());for(let{row:s,col:i}of r.iter()){const o=Math[""+t](...e.map(t=>t.get(s,i)));r.set(s,i,o)}return r}!function(t){t.EQ="="}(a=e.Assignment||(e.Assignment={})),function(t){t.COMMA=","}(c=e.Separator||(e.Separator={})),function(t){t.LEFT="(",t.RIGHT=")"}(l=e.Bracket||(e.Bracket={})),e.all_operator_symbols=[...Object.values(a),...Object.values(l),...Object.values(c),...Object.values(i.Operator),...Object.values(o.BuildInMathFn)].sort((t,e)=>e.length-t.length),e.operator_map=Object.values(i.Operator).reduce((t,e)=>Object.assign(Object.assign({},t),{[e]:e}),{}),e.isOperator=t=>!!e.operator_map[t],e.buildInMathFn_map=Object.values(o.BuildInMathFn).reduce((t,e)=>Object.assign(Object.assign({},t),{[e]:e}),{}),e.isBuildInMathFn=t=>!!e.buildInMathFn_map[t],e.is_number=t=>"number"==typeof t,e.is_matrix=t=>t instanceof s.Matrix,e.operator_precedence=u,e.calc=function(t,...e){try{let r=t.map(t=>t.replace(/\s/g,"")).map((t,r)=>{const s=void 0!==e[r]?[e[r]]:[];return""!==t?[...p(t),...s]:[...s]}).reduce((t,e)=>[...t,...e],[]);if(r=h(r),r[1]!==a.EQ)return r.length>1?m(r):r[0]instanceof s.Matrix?r[0].clone():r[0];{const t=m(r.slice(2));!function(t,e){if("number"==typeof e)t.fill(e);else for(let{value:r,row:s,col:i}of e.iter())t.set(s,i,r)}(r[0],t)}}catch(r){throw new Error(r)}},e.transformSignOperator=h,e.splitOperators=p,e.parseAsExpressionPart=d,e.splitOperator=f,e.compute=m,e.split_components=_,e.findClosingBracket=w,e.combine=g,e.evaluateOp=O,e.evaluateFn=v,e.evaluateMultiArgFn=b},"S/1a":function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=r("Rvsa");e.calc=s.calc;var i=r("a/+t");e.mat=i.mat,e.zeros=i.zeros;var o=r("kCE4");e.Matrix=o.Matrix},WZ91:function(t,e,r){"use strict";r.r(e);var s=r("S/1a"),i=r("lYyf");class o{constructor(t){this.L=1,this.g=9.81,this.duration=300,this.report_frequ=1,this.v_max=2,this.params=t,this.delta_x=this.L/this.params.n_grid,this.alpha=this.params.lambda/(this.params.rho*this.params.c_p),this.delta_t=this.calc_min_delta_t()}simulate(){console.log("Simulation starting with params:"),console.log(JSON.stringify(this.params));const t=Object(s.mat)(this.params.n_grid-2,this.params.n_grid-2).wrap(1).fill(this.params.T_c),e=Object(s.zeros)(this.params.n_grid,this.params.n_grid),r=Object(s.zeros)(this.params.n_grid,this.params.n_grid);let o;for(let s=0;s<=this.duration;s+=this.delta_t)Object(i.op)(t=>t).comp(t=>this.adjust_boundary(t)).comp(t=>this.time_adaptive_op(t)).comp(t=>this.params.includeBuoyancy?this.mom_convection_y_op(t):t).comp(t=>this.heat_convection_y_op(t)).comp(t=>this.diffusion_y_op(t)).comp(t=>this.diffusion_x_op(t)).comp(t=>this.adjust_boundary(t))({T:t,v_x:r,v_y:e}),(!o||s-o>=this.report_frequ)&&(postMessage({T:t.rawData(),t:s,delta_t:this.delta_t}),o=s)}time_adaptive_op(t){return this.v_max=s.calc`abs(${t.v_y})`.max(),this.delta_t=this.calc_min_delta_t(),t}calc_min_delta_t(){return Math.min(1,1/4*Math.pow(this.delta_x,2)/this.alpha,this.delta_x/this.v_max)}diffusion_x_op(t){let{T:e}=t;return e=e.shrink(1),s.calc`${e} = ${e} + ${this.alpha*this.delta_t/Math.pow(this.delta_x,2)}
      * (${e.shift_c(-1)} - 2 * ${e} + ${e.shift_c(1)})`,t}diffusion_y_op(t){let{T:e}=t;return e=e.shrink(1),s.calc`${e} = ${e} + ${this.alpha*this.delta_t/Math.pow(this.delta_x,2)}
      * (${e.shift_r(-1)} - 2 * ${e} + ${e.shift_r(1)})`,t}heat_convection_y_op(t){let{T:e,v_y:r}=t;return e=e.shrink(1),r=r.shrink(1),s.calc`${e} = ${e} -  ${r} % ${this.delta_t/this.delta_x} % (${e} - ${e.shift_r(-1)})`,t}mom_convection_y_op(t){let{T:e,v_y:r}=t;e=e.shrink(1);const i=e.shift_r(1),o=s.calc`${this.g} * max(0, (${e} - ${i})/${i})`;return r=r.shrink(1),s.calc`${r} = ${r} + ${this.delta_t} % ${o}
      - ${r} % ${this.delta_t/this.delta_x} % (${r} - ${r.shift_r(-1)})`,t}adjust_boundary(t){const{T:e,v_y:r}=t,[i,o]=e.shape();return e.filter(({row:t})=>0===t).fill(this.params.T_h),s.calc`${e.row(i-1)} = ${e.row(i-2)}`,s.calc`${e.col(0)} = ${e.col(1)}`,s.calc`${e.col(o-1)} = ${e.col(o-2)}`,s.calc`${r.row(i-1)} = ${r.row(i-2)}`,s.calc`${r.col(0)} = ${r.col(1)}`,s.calc`${r.col(o-1)} = ${r.col(o-2)}`,s.calc`${r.row(0)} = 0`,t}}addEventListener("message",({data:t})=>{new o(t).simulate()})},"a/+t":function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=r("kCE4");function i(...t){if(t[0]instanceof s.Matrix)return t[0].clone();if(Array.isArray(t[0])){const e=t[0].length,r=t[0].find(t=>t&&Array.isArray(t)),i=new s.Matrix(e,r?r.length:1);return t[0].forEach((t,e)=>t&&t.forEach((t,r)=>t&&i.set(e,r,t))),i}{const[e,r]=t;return new s.Matrix(e,r)}}e.mat=i,e.zeros=function(t,e){const r=i(t,e);for(let{row:s,col:i}of r.iter())r.set(s,i,0);return r},e.randu=function(t,e){const r=i(t,e);for(let{row:s,col:i}of r.iter())r.set(s,i,Math.random());return r}},kCE4:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=r("2Sa7");class i{constructor(t=0,e=0){this.rows=t,this.cols=e,this.initOperators(),this.data=[]}rawData(){return this.data}shape(){return[this.rows,this.cols]}clone(){const t=new i(this.rows,this.cols);for(let{value:e,row:r,col:s}of this.iter())null!=e&&t.set(r,s,e);return t}slice(...[t,e,r,s]){[t,e,r,s]=[...this.transToDataCoords(t,e),...this.transToDataCoords(r,s)];const o=new i(r-t+1,s-e+1);return o.data=this.data,o.coordFilter=this.coordFilter,o.sliceParams=[t,e,r,s],o}col(t){return this.slice(0,t,this.rows-1,t)}row(t){return this.slice(t,0,t,this.cols-1)}filter(t){const e=new i(this.rows,this.cols);e.data=this.data,e.coordFilter=[];for(let{row:r,col:s,value:i}of this.iter()){const[o,n]=this.transToDataCoords(r,s);e.coordFilter[o]||(e.coordFilter[o]=[]),e.coordFilter[o][n]=t({row:r,col:s,value:i})}return e}get(t,e){var r,s;return this.checkIndexes(t,e),[t,e]=this.transToDataCoords(t,e),this.checkFilterCoordinates(t,e),null===(s=null===(r=this.data)||void 0===r?void 0:r[t])||void 0===s?void 0:s[e]}fill(t){for(let{row:e,col:r}of this.iter())this.set(e,r,t);return this}shrink(t){return this.slice(t,t,this.rows-1-t,this.cols-1-t)}shift_c(t){return this.slice(0,t,this.rows-1,this.cols-1+t)}shift_r(t){return this.slice(t,0,this.rows-1+t,this.cols-1)}wrap(t){const e=this.clone();for(let r=1;r<=t;r++)e.addRow(0),e.addRow(e.rows),e.addColumn(0),e.addColumn(e.cols);return e}addRow(t,e=[]){if(this.coordFilter||this.sliceParams)throw new Error("Not supported for sliced or filtered matrixes.");this.rows=this.rows+1,this.data.splice(t,0,e)}addColumn(t,e=[]){var r;if(this.coordFilter||this.sliceParams)throw new Error("Not supported for sliced or filtered matrixes.");this.cols=this.cols+1;for(let s=0;s<this.data.length;s++)null===(r=this.data[s])||void 0===r||r.splice(t,0,e[s])}set(t,e,r){this.checkIndexes(t,e),this.data||(this.data=[]),[t,e]=this.transToDataCoords(t,e),this.checkFilterCoordinates(t,e),this.data[t]||(this.data[t]=[]),this.data[t][e]=r}iter(){return(function*(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++)this.isFilteredCoord(t,e)&&(yield{value:this.get(t,e),row:t,col:e})}).bind(this)()}print(){console.log("["),this.data.filter((t,e)=>!this.sliceParams||e>=this.sliceParams[0]&&e<=this.sliceParams[2]).forEach(t=>{const e=t.filter((t,e)=>!this.sliceParams||e>=this.sliceParams[1]&&e<=this.sliceParams[3]);console.log(`[${e}],`)}),console.log("]")}plus(t){return this.apply((e,r,s)=>e+t.get(r,s))}minus(t){return this.apply((e,r,s)=>e-t.get(r,s))}divide(t){return this.apply((e,r,s)=>e/t.get(r,s))}power(t){return this.apply((e,r,s)=>e**t.get(r,s))}elem_w_times(t){return this.apply((e,r,s)=>e*t.get(r,s))}times(t){if(this.coordFilter)throw new Error("Matrix multiplication not supported for filtered matrixes.");const e=new i(this.rows,t.cols);for(let{row:r,col:s}of e.iter()){let i=0;for(let e=0;e<this.cols;e++)i+=this.get(r,e)*t.get(e,s);e.set(r,s,i)}return e}mod(t){return this.apply((e,r,s)=>e%t.get(r,s))}max(){return Math.max(...[...this.iter()].map(({value:t})=>t))}min(){return Math.min(...[...this.iter()].map(({value:t})=>t))}apply(t){const e=this.clone();e.coordFilter=this.coordFilter;for(let{value:r,row:s,col:i}of this.iter())e.set(s,i,t(r,s,i));return e}checkIndexes(...[t,e]){if(t>this.rows||e>this.cols||t<0||e<0)throw new Error("Index out of bounds.")}initOperators(){Object.values(s.Operator).forEach(t=>{this[t]=this.createPartialFn(t)})}createPartialFn(t){return{[s.Operator.POWER]:t=>this.power(t),[s.Operator.TIMES]:t=>this.times(t),[s.Operator.ELEM_W_TIMES]:t=>this.elem_w_times(t),[s.Operator.DIVISION]:t=>this.divide(t),[s.Operator.PLUS]:t=>this.plus(t),[s.Operator.MINUS]:t=>this.minus(t)}[t]}transToDataCoords(t,e){return[this.sliceParams?this.sliceParams[0]+t:t,this.sliceParams?this.sliceParams[1]+e:e]}checkFilterCoordinates(t,e){if(this.coordFilter&&!this.coordFilter[t][e])throw new Error(`Coordinates ${t}, ${e} are not in filtered range.`)}isFilteredCoord(t,e){return[t,e]=this.transToDataCoords(t,e),!this.coordFilter||this.coordFilter[t][e]}}e.Matrix=i},lYyf:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=r("w9vU");Object.defineProperty(e,"op",{enumerable:!0,get:function(){return s.op}})},w9vU:function(t,e,r){"use strict";var s;function i(t){const e=(e,...r)=>t(e,...r);return e[s.comp]=e=>i(r=>t(e(r))),e[s.pipe]=e=>i(r=>e(t(r))),e[s.partial]=(...e)=>i((...r)=>t(...function(t,e){return t.includes("_")?function(t,e){e=[...e];for(let[r,s]of Object.entries(t))"_"===s&&(t[+r]=e.shift());return t}(t,e):[...t,...e]}(e,r))),e[s.mem]=()=>i(function(t){let e=new Map;return(...r)=>{const s=(e,i)=>{const[o,...n]=i;e.has(o)||e.set(o,new Map);const a=e.get(o);if(n.length)s(a,n);else if(!a.has(null)){const[e,...s]=r;a.set(null,t(e,...s))}return a.get(null)};return s(e,r)}}(t)),e}Object.defineProperty(e,"__esModule",{value:!0}),e.id=e.cons=e.op=e._=void 0,function(t){t.comp="comp",t.pipe="pipe",t.partial="partial",t.mem="mem"}(s||(s={})),e._="_",e.op=i,e.cons=function(t){return i(e=>t)},e.id=function(){return i(t=>t)}}});